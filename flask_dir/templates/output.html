<!DOCTYPE html>
<html lang="en">
 <head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="description" content="">
   <meta name="author" content="">
   <link rel="icon" href="../../favicon.ico">

   <title>Describe Your Bar</title>

   
    <!-- Bootstrap Core CSS -->
    <link href="../static/css/bootstrap.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../static/css/stylish-portfolio.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="../static/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/css/bootstrap-select.min.css">


   <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
   <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
   <script src="../../assets/js/ie-emulation-modes-warning.js"></script>

   <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
   <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>

   <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->
 </head>

 <body>

<style type="text/css">
.column-left{ float: left; width: 40%; }
.column-right{ float: right; width=100px; padding-top: 5px;}
.column-center{ display: inline-block; width: 330px;  padding-top: 5px;}

#wrap_map {

  width:100%;
  min-height: 100%;
  height: auto !important;
  height: 100%;
  margin: 0 0 -30px 0;
  padding-top: 0px;
}
#left_col_map {
   float:left;
   width:30%;
   height:100%;
}
#right_col_map {
   float:right;
   width:70%;
   min-height: 100%;
   height: auto !important;
    margin: 0 0 -30px 0;
    padding-top: 5px;
 }
iframe {
    display: block;
    background: #000;
    border: none;
    height: calc(100vh - 30px);
    width: 100%;
}
    .wrapper{margin: 0 0 -30px 0;position:relative;}
    .right,.left{width:50%; position:absolute;}
    .right{right:0;}
    .left{left:0;}
</style>




</style>

   
   <div class="navbar navbar-inverse" role="navigation" style:"margin_bottom:0px;">
     <div class="container">
      <div class="column-left">
       <div class="navbar-header">
             <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
               <span class="sr-only">Toggle navigation</span>
               <span class="icon-bar"></span>
               <span class="icon-bar"></span>
               <span class="icon-bar"></span>
             </button>
             <a class="navbar-brand" href="#">Describe Your Bar</a>
        </div>
        <div class="collapse navbar-collapse">
           <ul class="nav navbar-nav">
             <!-- <li class="active"><a href="#">Home</a></li> -->
<!--              <li><a href="#about">About</a></li>
             <li><a href="#contact">Contact</a></li> -->
           </ul>
        </div>
      </div>
      <form  action="/output" method="GET">
      <div class="column-center">
            
                    <textarea align="right" rows="2" cols="50" id="text_review" name='text_review'>{{review_text}} </textarea>
                    <select class="selectpicker" data-live-search="true" id="sel_city" name="sel_city" style="width:auto;">
                      <option selected>San Francisco, CA</option>
                        {% for city_state in city_state_list %}
                          <option>{{ city_state['city'] }}</option>
                        {% endfor %}                       
                    </select>
           
         </div>
           <div class="column-right">
                   <button type="submit" class="btn btn-default btn-lg" width="300px" 
                            style:"font-size: 24px; vertical-align: top; ">Search</button>
           </div>
         </form>
     </div>
   </div>


    <!-- Header -->
 <!--    <header id="top" class="header">
        <div class="text-center" style="padding-top:50px">
            <div id="wrap">
              <div id="left_col">
                <div width:"250px" height:"250px">
                  <img src={{image_path_query}} alt="Image Not Found" style="width:100%;height:100%;"> 
                </div>
              </div>

            <div id="right_col">
              <form  action="/output" method="GET">
                <label for="sel_city">Select City:</label>
                <div align="center" style="width:auto; margin:0 auto;">
                  <select class="form-control" id="sel_city" data-live-search="true" style="width:auto;">
                      <option>San Francisco, CA</option>
                      <option>Las Vegas, NV</option>
                      <option>Pheonix, AZ</option>
                  </select>
                </div>
                <br>

                <div class="form-group">
                  <textarea rows="6" cols="50" id="text_review" name='text_review'>They had great beer and wine! They even allow dogs. </textarea>
                </div>
                
                <div>
                  <button type="submit" class="btn btn-default btn-lg" width="300px" 
                          style:"padding: 18px 24px;font-size: 24px;">Search</button>
                </div>

              </form>
            </div>
        </div>
      </div>
    </header> -->

<!-- <section id="about" class="about" style:"padding:0px;"> -->
<section id="about" style:"padding:0px;">
  <div id="wrap_map">
      <div id="left_col_map">    
<!--                 <br>
                <div align="center" style:"padding-top: 50px;">
                  <div style="float:left;"> 
                    <textarea align="center" rows="4" cols="60" id="text_review" name='text_review', >{{review_text}} </textarea>
                  </div>

                  <div style="float:right;">
                    <button type="submit" class="btn btn-default btn-lg" width="300px" 
                            style:"padding-bottom:10%; font-size: 24px;">Search</button>
                </div> -->

  <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>

<script>

// Mike Bostock "margin conventions"
var margin = {top: 20, right: 20, bottom: 20, left: 20},
    width = 340 - margin.left - margin.right,
    height = 540 - margin.top - margin.bottom;

// D3 scales = just math
// x is a function that transforms from "domain" (data) into "range" (usual pixels)
// domain gets set after the data loads
var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var y = d3.scale.linear()
    .range([height, 0]);

// D3 Axis - renders a d3 scale in SVG
var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    //.ticks(10, "%");

// create an SVG element (appended to body)
// set size
// add a "g" element (think "group")
// annoying d3 gotcha - the 'svg' variable here is a 'g' element
// the final line sets the transform on <g>, not on <svg>
var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")


svg.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + height + ")")
    .call(xAxis)
    .selectAll("text")  
        .style("text-anchor", "end")
        .attr("dx", "-.8em")
        .attr("dy", ".15em")
        //.attr("transform", "rotate(-65)" );


// Y-Axis
// svg.append("g")
//     .attr("class", "y axis")
//   .append("text") // just for the title (ticks are automatic)
//     .attr("transform", "rotate(-90)") // rotate the text!
//     .attr("y", 6)
//     .attr("dy", "4em")
//     .style("text-anchor", "end")
//     .text("Importance");

// d3.tsv is a wrapper around XMLHTTPRequest, returns array of arrays (?) for a TSV file
// type function transforms strings to numbers, dates, etc.
// d3.tsv("data.tsv", type, function(error, data) {
//     console.log(data);
//     //replay(data);
//     draw(data);
// });

var req = new XMLHttpRequest()
req.onreadystatechange = function()
{
    if (req.readyState == 4)
    {
        if (req.status != 200)
        {
            //error handling code here
        }
        else
        {

            var response = JSON.parse(req.responseText)

            console.log(response.mean_topic);
            console.log(response.topic_words);

            var arr = [];

            for(var x in response.topic_words){
              arr.push( {letter:response.topic_words[x], frequency:response.mean_topic[x]} );
            }

            //var dict = {letter:"Test", frequency:1};

            draw(arr);
            //alert("Response "+ response.lat +"," + response.lon);

            //document.getElementById('myDiv').innerHTML = response.username
        }
    }
}


var lat = 37.7836341646 ;
var lon = -122.418980494;
req.open('GET', 'http://planck.ucsc.edu:5000/ajax?lat='+String(lat)+'&lon='+String(lon))
req.setRequestHeader("Content-type", "application/x-www-form-urlencoded")
req.send()



function type(d) {
  // + coerces to a Number from a String (or anything)
  d.frequency = +d.frequency;
  return d;
}

function replay(data) {
  var slices = [];
  for (var i = 0; i < data.length; i++) {
    slices.push(data.slice(0, i+1));
  }
  slices.forEach(function(slice, index){
    setTimeout(function(){
      draw(slice);
    }, index * 50);
  });
}

function draw(data) {
  // measure the domain (for x, unique letters) (for y [0,maxFrequency])
  // now the scales are finished and usable
  x.domain(data.map(function(d) { return d.letter; }));
  y.domain([0, d3.max(data, function(d) { return d.frequency; })]);

  // another g element, this time to move the origin to the bottom of the svg element
  // someSelection.call(thing) is roughly equivalent to thing(someSelection[i])
  //   for everything in the selection\
  // the end result is g populated with text and lines!
  svg.select('.x.axis').transition().duration(200).call(xAxis);

  // same for yAxis but with more transform and a title
  svg.select(".y.axis").transition().duration(200).call(yAxis);
  //svg.attr("translate(0,400)")

  // THIS IS THE ACTUAL WORK!
  var bars = svg.selectAll(".bar").data(data, function(d) { return d.letter; })  // (data) is an array/iterable thing, second argument is an ID generator function

  svg.selectAll("text")  
        .style("text-anchor", "start")
        // .attr("x", "2em")
        .attr("dx", "1em")
        .attr("dy", ".15em")
        .attr("transform", "rotate(-90)" )
        .attr("font-size","20px")

    svg.attr("transform", "rotate(0)" );

  bars.exit()
    .transition()
      .duration(200)
    .attr("y", y(0))
    .attr("height", height - y(0))
    .style('fill-opacity', 1e-6)
    .remove();

  // data that needs DOM = enter() (a set/selection, not an event!)
  bars.enter().append("rect")
    .attr("class", "bar")
    .attr("y", y(0))
    .attr("height", height - y(0));

  // the "UPDATE" set:
  
  bars.transition().duration(200)
    .attr("x", function(d) { return x(d.letter); }) // (d) is one item from the data array, x is the scale object from above
    .attr("width", x.rangeBand()) // constant, so no callback function(d) here
    .attr("y", function(d) { return y(d.frequency); })
    .attr("height", function(d) { return height - y(d.frequency); }) // flip the height, because y's domain is bottom up, but SVG renders top down

 svg.attr("transform","rotate(90,250,250)"); 
  
}

 </script>

            <table class="table table-hover">
            {% for top_bus in top_businesses %}
            <tr><td><h4><a href={{ top_bus['URL'] }}> {{ top_bus['bus_name'] }}</a></h4>
              <img src={{ top_bus['image_URL'] }} alt="" style="width:100px;height:100px;"> {{ bus_id }} </td>
              <!-- <td>{{top_bus['image_path']}}</td></tr> -->
              <!-- <td><img src={{top_bus['image_path']}} alt="uh oh!" style="width:200px;height:200px;"></td></tr> -->
            {% endfor %}
            </table>
      </div>
      <div id="right_col_map" onmousemove="return MouseMove(event)">
          <iframe width="100%" frameborder="0" src={{map_path}}></iframe>

          <form  action="/output" method="GET">
                
                <div class="form-group" align="center">
                <label for="sel_city">Select City:</label>
                    <div class="btn-group bootstrap-select dropdown" align="center" style="width:auto; margin:0 auto;">
                    <select class="selectpicker" data-live-search="true" id="sel_city" name="sel_city" style="width:auto;">
                      <option selected>San Francisco, CA</option>
                        {% for city_state in city_state_list %}
                          <option>{{ city_state['city'] }}</option>
                        {% endfor %}                       
                    </select>
                  </div>
<!--                 <br>
                  <textarea align="center" rows="6" cols="50" id="text_review" name='text_review'>{{review_text}} </textarea>
                </div>
                
                <div align="center">
                  <button type="submit" class="btn btn-default btn-lg" width="300px" 
                          style:"padding: 18px 24px;font-size: 24px;">Search</button>
                </div> -->

              </form>

              <p id="coords"></p>

      </div>


<!-- 
  <div <div align="center" style="width:auto; margin:0 auto;padding-top:2%;"  >
    <iframe width="80%" height="640" frameborder="0" src={{map_path}}></iframe>
  </div> 
</section>



    <section id="about" class="about">
        <div class="container">
            


          <div id="wrap">
              <div id="left_col">
                <div width:"250px" height:"250px">
                  <img src={{image_path_query}} alt="Image Not Found" style="width:100%;height:100%;"> 
                </div>
              </div>

            <div id="right_col">
              <form  action="/output" method="GET">
                
                <div class="form-group">
                <label for="sel_city">Select City:</label>
                <div align="center" style="width:auto; margin:0 auto;">
                   <select class="form-control" id="sel_city" name="sel_city" data-live-search="true" style="width:auto;"> 
                  <select class="selectpicker" data-live-search="true" id="sel_city" name="sel_city" style="width:auto;">
                      <option selected>San Francisco, CA</option>
                      {% for city_state in city_state_list %}
                        <option>{{ city_state['city'] }}</option>
                      {% endfor %}
                       <option>Las Vegas, NV</option>
                      <option>Pheonix, AZ</option> 
                  </select>
                </div>
                <br>
                  <textarea rows="6" cols="50" id="text_review" name='text_review'>They had great beer and wine! They even allow dogs. </textarea>
                </div>
                
                <div>
                  <button type="submit" class="btn btn-default btn-lg" width="300px" 
                          style:"padding: 18px 24px;font-size: 24px;">Search</button>
                </div>

              </form>
            </div>
        </div>
        </div>
    </section>   -->  
    
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
   <script src="static/js/bootstrap.js"></script>
       <!-- Latest compiled and minified JavaScript -->
</div> 



<!--     <div class="container">
      <div class="stylish-portfolio">
        <h3>Here are bars matching your style...</h3>
        <br>
      </div>

      <table class="table table-hover">
      <tr><th>Business Name</th><th>Business ID</th><th>Similarity</th></tr>
      {% for top_bus in top_businesses %}
      <tr><td>{{ top_bus['bus_name']}}</td><td>{{ top_bus['bus_id'] }}</td><td>{{ top_bus['similarity']}}</td>
        <!-- <td>{{top_bus['image_path']}}</td></tr>
        <td><img src={{top_bus['image_path']}} alt="uh oh!" style="width:250px;height:250px;"></td></tr>
      {% endfor %}
      </table>


     </div><!-- /.container

    <div class="container">

     </div><!-- /.container --> 




<div id="map"></div>
    <script>

      // This example requires the Visualization library. Include the libraries=visualization
      // parameter when you first load the API. For example:
      // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=visualization">

      var map, heatmap;

      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 13,
          center: {lat: 37.775, lng: -122.434},
          mapTypeId: google.maps.MapTypeId.SATELLITE
        });

        heatmap = new google.maps.visualization.HeatmapLayer({
          data: getPoints(),
          map: map
        });
      }

      function toggleHeatmap() {
        heatmap.setMap(heatmap.getMap() ? null : map);
      }

      function changeGradient() {
        var gradient = [
          'rgba(0, 255, 255, 0)',
          'rgba(0, 255, 255, 1)',
          'rgba(0, 191, 255, 1)',
          'rgba(0, 127, 255, 1)',
          'rgba(0, 63, 255, 1)',
          'rgba(0, 0, 255, 1)',
          'rgba(0, 0, 223, 1)',
          'rgba(0, 0, 191, 1)',
          'rgba(0, 0, 159, 1)',
          'rgba(0, 0, 127, 1)',
          'rgba(63, 0, 91, 1)',
          'rgba(127, 0, 63, 1)',
          'rgba(191, 0, 31, 1)',
          'rgba(255, 0, 0, 1)'
        ]
        heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);
      }

      function changeRadius() {
        heatmap.set('radius', heatmap.get('radius') ? null : 20);
      }

      function changeOpacity() {
        heatmap.set('opacity', heatmap.get('opacity') ? null : 0.2);
      }

      // Heatmap data: 500 Points
      function getPoints() {
        return [
          new google.maps.LatLng(37.782551, -122.445368),
          new google.maps.LatLng(37.782745, -122.444586),
          new google.maps.LatLng(37.782842, -122.443688),
          new google.maps.LatLng(37.782919, -122.442815),
          new google.maps.LatLng(37.782992, -122.442112),
          new google.maps.LatLng(37.783100, -122.441461),
          new google.maps.LatLng(37.783206, -122.440829),
          new google.maps.LatLng(37.783273, -122.440324),
          new google.maps.LatLng(37.783316, -122.440023),
          new google.maps.LatLng(37.783357, -122.439794),
          new google.maps.LatLng(37.783371, -122.439687),
          new google.maps.LatLng(37.783368, -122.439666),
        ];
      }
    </script>


    <script>
      function MouseMove(e) {
          var x = e.clientX;
          var y = e.clientY;
          var coor = "Coordinates: (" + x + "," + y + ")";
          document.getElementById("coords").innerHTML = coor;
      }
    </script> 


    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCsTw9mRQRsE3wvqpOVYJJwd3RK59SEWrY&libraries=visualization&callback=initMap">
    </script>


<div>
<style>
</style>
</head>


<body>

<div onmousemove="myFunction(event)" onmouseout="clearCoor()"></div>

<p>Mouse over the rectangle above, and get the coordinates of your mouse pointer.</p>

<p>When the mouse is moved over the div, the p element will display the horizontal and vertical coordinates of your mouse pointer, whose values are returned from the clientX and clientY properties on the
MouseEvent object.</p>

<p id="demo"></p>

<script>
function myFunction(e) {
    var x = e.clientX;
    var y = e.clientY;
    var coor = "Coordinates: (" + x + "," + y + ")";
    document.getElementById("demo").innerHTML = coor;
}

function clearCoor() {
    document.getElementById("demo").innerHTML = "";
}
</script>
</div>


</body>
</html>